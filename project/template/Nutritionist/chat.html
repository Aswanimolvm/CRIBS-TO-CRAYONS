<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat between {{ sender.username }} and {{ receiver.username }}</title>
</head>
<body>
    <h1>Chat between {{ sender.username }} and {{ receiver.username }}</h1>
    <div id="messages">
        {% for message in messages %}
            <p>{{ message.sender }}: {{ message.message }}</p>
        {% endfor %}
    </div>
    <form id="messageForm">
        {% csrf_token %}
        <input type="text" id="messageInput" autocomplete="off">
        <button type="submit">Send</button>
    </form>
    <script>
        document.getElementById('messageForm').onsubmit = function(event) {
            event.preventDefault();
            var messageInput = document.getElementById('messageInput');
            var message = messageInput.value.trim();
            if (message !== '') {
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/send_message/{{ sender.id }}/{{ receiver.id }}/');
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        if (response.status === 'ok') {
                            messageInput.value = '';
                            // Add the new message to the messages section
                            var messagesDiv = document.getElementById('messages');
                            var p = document.createElement('p');
                            p.textContent = response.message.sender + ': ' + response.message.message;
                            messagesDiv.appendChild(p);
                        } else {
                            // Handle error response if needed
                            console.error('Error sending message:', response);
                        }
                    }
                };
                xhr.send('message=' + encodeURIComponent(message));
            }
        };
    </script>
    
</body>
</html>